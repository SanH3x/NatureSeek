<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estat√≠sticas - InteliAgro</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Estat√≠sticas Detalhadas</h1>
            <a href="{{ url_for('index') }}" class="btn btn-voltar">‚Üê Voltar para In√≠cio</a>
        </header>

        <nav class="menu">
            <a href="{{ url_for('index') }}">In√≠cio</a>
            <a href="{{ url_for('cadastro') }}">Cadastro</a>
            <a href="{{ url_for('consulta') }}">Consulta</a>
            <a href="{{ url_for('estatisticas') }}" class="active">Estat√≠sticas</a>
        </nav>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Cards de Estat√≠sticas Gerais -->
        <div class="cards-estatisticas">
            <div class="card-estatistica">
                <h3>Total de Registros</h3>
                <div class="numero">{{ totais.total_registros or 0 }}</div>
            </div>
            <div class="card-estatistica">
                <h3>Total de Hectares</h3>
                <div class="numero">{{ "%.2f"|format(totais.total_hectares|float) if totais.total_hectares else '0.00' }} ha</div>
            </div>
            <div class="card-estatistica">
                <h3>Termos de Pragas</h3>
                <div class="numero">{{ totais.estatisticas_multiplos.total_termos_pragas if totais.estatisticas_multiplos else 0 }}</div>
            </div>
            <div class="card-estatistica">
                <h3>Termos de Defensivos</h3>
                <div class="numero">{{ totais.estatisticas_multiplos.total_termos_defensivos if totais.estatisticas_multiplos else 0 }}</div>
            </div>
        </div>

        <!-- Estat√≠sticas de M√∫ltiplos Termos -->
        {% if totais.estatisticas_multiplos %}
        <div class="cards-estatisticas">
            <div class="card-estatistica">
                <h3>M√©dia de Pragas/Registro</h3>
                <div class="numero">{{ totais.estatisticas_multiplos.media_pragas_por_registro }}</div>
            </div>
            <div class="card-estatistica">
                <h3>M√©dia de Defensivos/Registro</h3>
                <div class="numero">{{ totais.estatisticas_multiplos.media_defensivos_por_registro }}</div>
            </div>
            <div class="card-estatistica">
                <h3>Pragas √önicas</h3>
                <div class="numero">{{ totais.frequencia_pragas|length if totais.frequencia_pragas else 0 }}</div>
            </div>
            <div class="card-estatistica">
                <h3>Defensivos √önicos</h3>
                <div class="numero">{{ totais.frequencia_defensivos|length if totais.frequencia_defensivos else 0 }}</div>
            </div>
        </div>
        {% endif %}

        <!-- Resumo Estat√≠stico -->
        <section class="resumo-estatistico">
            <h2>üìã Resumo Geral</h2>
            <div class="resumo-grid">
                <div class="resumo-item">
                    <h4>üåæ Cultivo Mais Frequente</h4>
                    <p>
                        {% if totais.frequencia_cultivos %}
                            {% set top_cultivo = totais.frequencia_cultivos.items()|first %}
                            <strong>{{ top_cultivo[0] }}</strong> - {{ top_cultivo[1].frequencia }} ocorr√™ncias ({{ top_cultivo[1].percentual }}%)
                        {% else %}
                            Nenhum dado dispon√≠vel
                        {% endif %}
                    </p>
                </div>
                <div class="resumo-item">
                    <h4>üêõ Praga Mais Comum</h4>
                    <p>
                        {% if totais.frequencia_pragas %}
                            {% set top_praga = totais.frequencia_pragas.items()|first %}
                            <strong>{{ top_praga[0] }}</strong> - {{ top_praga[1].frequencia }} ocorr√™ncias ({{ top_praga[1].percentual }}%)
                        {% else %}
                            Nenhum dado dispon√≠vel
                        {% endif %}
                    </p>
                </div>
                <div class="resumo-item">
                    <h4>üß™ Defensivo Mais Usado</h4>
                    <p>
                        {% if totais.frequencia_defensivos %}
                            {% set top_defensivo = totais.frequencia_defensivos.items()|first %}
                            <strong>{{ top_defensivo[0] }}</strong> - {{ top_defensivo[1].frequencia }} usos ({{ top_defensivo[1].percentual }}%)
                        {% else %}
                            Nenhum dado dispon√≠vel
                        {% endif %}
                    </p>
                </div>
                <div class="resumo-item">
                    <h4>üèôÔ∏è Cidade com Mais Registros</h4>
                    <p>
                        {% if totais.frequencia_cidades %}
                            {% set top_cidade = totais.frequencia_cidades.items()|first %}
                            <strong>{{ top_cidade[0] }}</strong> - {{ top_cidade[1].frequencia }} registros ({{ top_cidade[1].percentual }}%)
                        {% else %}
                            Nenhum dado dispon√≠vel
                        {% endif %}
                    </p>
                </div>
            </div>
        </section>

        <!-- Distribui√ß√£o por Categoria - BOXES FIXAS -->
        <section class="distribuicao">
            <h2>üìà Frequ√™ncia por Categoria</h2>
            <div class="categorias-grid">
                
                <!-- Frequ√™ncia de Cultivos -->
                <div class="categoria-box">
                    <div class="categoria-header">
                        <h3>
                            üåæ Cultivos
                            <span class="contador">
                                {{ totais.frequencia_cultivos.values()|map(attribute='frequencia')|sum if totais.frequencia_cultivos else 0 }}
                            </span>
                        </h3>
                    </div>
                    <div class="categoria-content">
                        {% if totais.frequencia_cultivos %}
                            <ul class="lista-frequencia">
                                {% for cultivo, dados in totais.frequencia_cultivos.items() %}
                                <li>
                                    <span class="item-nome">{{ cultivo }}</span>
                                    <span class="item-frequencia">
                                        {{ dados.frequencia }} ocorr√™ncia(s)
                                        <small>({{ dados.percentual }}%)</small>
                                    </span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="sem-dados">Nenhum cultivo cadastrado</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Frequ√™ncia de Pragas -->
                <div class="categoria-box">
                    <div class="categoria-header">
                        <h3>
                            üêõ Pragas
                            <span class="contador">
                                {{ totais.frequencia_pragas.values()|map(attribute='frequencia')|sum if totais.frequencia_pragas else 0 }}
                            </span>
                        </h3>
                    </div>
                    <div class="categoria-content">
                        {% if totais.frequencia_pragas %}
                            <ul class="lista-frequencia">
                                {% for praga, dados in totais.frequencia_pragas.items() %}
                                <li>
                                    <span class="item-nome">{{ praga }}</span>
                                    <span class="item-frequencia">
                                        {{ dados.frequencia }} ocorr√™ncia(s)
                                        <small>({{ dados.percentual }}%)</small>
                                    </span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="sem-dados">Nenhuma praga cadastrada</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Frequ√™ncia de Defensivos -->
                <div class="categoria-box">
                    <div class="categoria-header">
                        <h3>
                            üß™ Defensivos
                            <span class="contador">
                                {{ totais.frequencia_defensivos.values()|map(attribute='frequencia')|sum if totais.frequencia_defensivos else 0 }}
                            </span>
                        </h3>
                    </div>
                    <div class="categoria-content">
                        {% if totais.frequencia_defensivos %}
                            <ul class="lista-frequencia">
                                {% for defensivo, dados in totais.frequencia_defensivos.items() %}
                                <li>
                                    <span class="item-nome">{{ defensivo }}</span>
                                    <span class="item-frequencia">
                                        {{ dados.frequencia }} uso(s)
                                        <small>({{ dados.percentual }}%)</small>
                                    </span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="sem-dados">Nenhum defensivo cadastrado</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Frequ√™ncia de Cidades -->
                <div class="categoria-box">
                    <div class="categoria-header">
                        <h3>
                            üèôÔ∏è Cidades
                            <span class="contador">
                                {{ totais.frequencia_cidades.values()|map(attribute='frequencia')|sum if totais.frequencia_cidades else 0 }}
                            </span>
                        </h3>
                    </div>
                    <div class="categoria-content">
                        {% if totais.frequencia_cidades %}
                            <ul class="lista-frequencia">
                                {% for cidade, dados in totais.frequencia_cidades.items() %}
                                <li>
                                    <span class="item-nome">{{ cidade }}</span>
                                    <span class="item-frequencia">
                                        {{ dados.frequencia }} registro(s)
                                        <small>({{ dados.percentual }}%)</small>
                                    </span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="sem-dados">Nenhuma cidade cadastrada</p>
                        {% endif %}
                    </div>
                </div>

            </div>
        </section>
    </div>
</body>
</html>
