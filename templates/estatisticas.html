<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estat√≠sticas - InteliAgro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=1.2">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Estat√≠sticas Agr√≠colas</h1>
            <a href="{{ url_for('index') }}" class="btn-voltar">‚Üê Voltar</a>
        </header>

        <nav class="menu">
            <a href="{{ url_for('index') }}">In√≠cio</a>
            <a href="{{ url_for('cadastro') }}">Cadastro</a>
            <a href="{{ url_for('consulta') }}">Consulta</a>
            <a href="{{ url_for('estatisticas') }}" class="active">Estat√≠sticas</a>
        </nav>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if mensagem %}
            <div class="alert alert-info">{{ mensagem }}</div>
        {% endif %}

        <main>
            {% if estatisticas %}
            <!-- Estat√≠sticas Gerais -->
            <section class="estatisticas-gerais">
                <h2>üìà Estat√≠sticas Gerais</h2>
                <div class="cards-estatisticas">
                    <div class="card-estatistica">
                        <h3>Total de Registros</h3>
                        <p class="numero">{{ estatisticas.total_registros }}</p>
                    </div>
                    <div class="card-estatistica">
                        <h3>√Årea Total (ha)</h3>
                        <p class="numero">{{ "%.2f"|format(estatisticas.total_hectares) }}</p>
                    </div>
                    <div class="card-estatistica">
                        <h3>M√©dia por √Årea (ha)</h3>
                        <p class="numero">{{ "%.2f"|format(estatisticas.media_hectares) }}</p>
                    </div>
                    <div class="card-estatistica">
                        <h3>Total de Cultivos</h3>
                        <p class="numero">{{ estatisticas.total_cultivos }}</p>
                    </div>
                    <div class="card-estatistica">
                        <h3>Total de Pragas</h3>
                        <p class="numero">{{ estatisticas.total_pragas }}</p>
                    </div>
                    <div class="card-estatistica">
                        <h3>Total de Defensivos</h3>
                        <p class="numero">{{ estatisticas.total_defensivos }}</p>
                    </div>
                </div>
            </section>


            <!-- Distribui√ß√£o por Categoria -->
            <section class="distribuicao">
                <h2>üìä Distribui√ß√£o Geral</h2>
                <div class="categorias-grid">
                    <div class="categoria-expansivel">
                        <div class="categoria-header" onclick="toggleCategoria('cultivos')">
                            <h3>üåæ Cultivos</h3>
                            <span class="toggle-icon">‚ñº</span>
                        </div>
                        <div id="cultivos" class="categoria-content">
                            {% if totais.cultivos %}
                                <ul>
                                    {% for cultivo, quantidade in totais.cultivos.items() %}
                                    <li>{{ cultivo }}: <strong>{{ quantidade }}</strong> registro(s)</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="sem-dados">Nenhum dado dispon√≠vel</p>
                            {% endif %}
                        </div>
                    </div>

                    <div class="categoria-expansivel">
                        <div class="categoria-header" onclick="toggleCategoria('pragas')">
                            <h3>üêõ Pragas (√önicas)</h3>
                            <span class="toggle-icon">‚ñº</span>
                        </div>
                        <div id="pragas" class="categoria-content">
                            {% if totais.pragas_unicas %}
                                <ul>
                                    {% for praga, quantidade in totais.pragas_unicas.items() %}
                                    <li>{{ praga }}: <strong>{{ quantidade }}</strong> ocorr√™ncia(s)</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="sem-dados">Nenhum dado dispon√≠vel</p>
                            {% endif %}
                        </div>
                    </div>

                    <div class="categoria-expansivel">
                        <div class="categoria-header" onclick="toggleCategoria('defensivos')">
                            <h3>üß™ Defensivos (√önicos)</h3>
                            <span class="toggle-icon">‚ñº</span>
                        </div>
                        <div id="defensivos" class="categoria-content">
                            {% if totais.defensivos_unicos %}
                                <ul>
                                    {% for defensivo, quantidade in totais.defensivos_unicos.items() %}
                                    <li>{{ defensivo }}: <strong>{{ quantidade }}</strong> uso(s)</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="sem-dados">Nenhum dado dispon√≠vel</p>
                            {% endif %}
                        </div>
                    </div>

                    <div class="categoria-expansivel">
                        <div class="categoria-header" onclick="toggleCategoria('cidades')">
                            <h3>üèôÔ∏è Cidades</h3>
                            <span class="toggle-icon">‚ñº</span>
                        </div>
                        <div id="cidades" class="categoria-content">
                            {% if totais.cidades %}
                                <ul>
                                    {% for cidade, quantidade in totais.cidades.items() %}
                                    <li>{{ cidade }}: <strong>{{ quantidade }}</strong> registro(s)</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="sem-dados">Nenhum dado dispon√≠vel</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}
        </main>
    </div>

<script>
    let categoriaAberta = null;

    function toggleCategoria(id) {
        const content = document.getElementById(id);
        const icon = content.previousElementSibling.querySelector('.toggle-icon');
        
        // Se j√° existe uma categoria aberta, fecha ela
        if (categoriaAberta && categoriaAberta !== content) {
            const iconAnterior = categoriaAberta.previousElementSibling.querySelector('.toggle-icon');
            categoriaAberta.style.maxHeight = '0px';
            categoriaAberta.style.padding = '0';
            iconAnterior.textContent = '‚ñº';
        }
        
        // Alterna a categoria clicada
        if (content.style.maxHeight && content.style.maxHeight !== '0px') {
            // Se est√° aberta, fecha
            content.style.maxHeight = '0px';
            content.style.padding = '0';
            icon.textContent = '‚ñº';
            categoriaAberta = null;
        } else {
            // Se est√° fechada, abre
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.padding = '1.5rem';
            icon.textContent = '‚ñ≤';
            categoriaAberta = content;
        }
    }

    // Inicializa todas as categorias como fechadas ao carregar a p√°gina
    document.addEventListener("DOMContentLoaded", function() {
        const categorias = document.querySelectorAll(".categoria-content");
        
        categorias.forEach(categoria => {
            categoria.style.maxHeight = "0px";
            categoria.style.padding = "0";
        });
        
        categoriaAberta = null;
    });
</script>
</html>
